{% extends "base.html" %}
{% load static %}
{% load date_filters %}
{% load ui_template_tag %}
{% load widget_tweaks %}
{% block title %}
    جزئیات منشا ارزی بانکی
{% endblock title %}
{% block page-title %}
    جزئیات منشا ارزی بانکی
{% endblock page-title %}
{% block breadcrumbs %}
    {% breadcrumbs 'عملیات ارزی' '#' 'تعیین منشا ارز' '#' 'منشا ارز بانکی' 'currency_origin_determining:create_banking' 'جزئیات منشا ارزی بانکی' '#' %}
{% endblock breadcrumbs %}
{% block head %}
    <link href="{% static 'selectize-master/css/selectize.css' %}"
          rel="stylesheet">
    <link href="{% static 'bootstrap-datepicker/css/bootstrap-datepicker.min.css' %}"
          rel="stylesheet">
{% endblock head %}
{% block main %}
    <div class="container-fluid bg-white py-4" id="banking-form">
        <div class="row">
            {% input_box 'کد یکتای منشا ارز' object.identifier %}
            {% input_box 'شماره پرونده' object.file_number %}
            {% input_box 'شماره ثبت سفارش' object.main_data.identifier %}
            {% input_box 'کشور مبدا حمل' object.origin_country %}
            {% input_box 'مرز ورودی' object.entrance_edge %}
            {% input_box 'گمرک مقصد' object.custom_destination %}
            {% input_box 'شماره اظهار نامه گمرکی' '-' %}
            {% input_box 'مبلغ فوب' object.fob_amount %}
            {% input_box 'مبلغ حمل' object.shipping_price %}
            {% input_box 'مبلغ بازرسی' object.inspection_amount %}
            {% input_box 'تخفیف' object.off %}
            {% input_box 'سایر هزینه‌ها' object.other_cost %}
            {% input_box 'مبلغ کل' object.total_price %}
            {% input_box 'تاریخ منشا' object.created_at|to_jalali %}
            {% input_box 'کد SATA' object.sata %}
            {% input_box 'وضعیت منشا' object.get_status_display %}
            {% input_box 'پاسخ بانک' 'منشا ارز با موفقیت ثبت شد' disabled=True div_with="col-12" %}
            <div class="col-12">
                <div class="border rounded">
                    <p class=" bg-gray p-2">افزودن بارنامه</p>
                    <div class="row m-3">
                        <div class="col-12 col-md-6 col-lg-4 mx-auto">
                            <table class="table table-striped table-hover table-bordered text-center">
                                <thead class="text-white bg-navy">
                                    <tr>
                                        <th>ردیف</th>
                                        <th>شماره بارنامه</th>
                                        <th>کدرهگیری بارنامه</th>
                                        <th>تاریخ صدور بارنامه</th>
                                    </tr>
                                </thead>
                                <tbody id="billing-body" class="text-center">
                                    {% for b in object.bilings.all %}
                                        <tr>
                                            <td>{{ forloop.counter }}</td>
                                            <td>{{ b.identifier }}</td>
                                            <td>{{ b.tracking_code }}</td>
                                            <td>{{ b.date|date:"Y/m/d" }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 mt-5">
                <table class="table table-striped table-hover table-bordered text-center">
                    <thead class="text-white bg-navy">
                        <tr>
                            <th>ردیف</th>
                            <th>کد مجازی کالا</th>
                            <th>کد تعرفه</th>
                            <th>شرح تجاری فارسی</th>
                            <th>قیمت واحد</th>
                            <th>وزن ناخالص</th>
                            <th>وزن خالص</th>
                            <th>مقدار/تعداد</th>
                            <th>تعداد بسته</th>
                            <th>مبلغ فوب</th>
                            <th>شناسه کالا</th>
                        </tr>
                    </thead>
                    <tbody id="ware-table-body" class="text-center">
                        {% for w in object.wares.all %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td></td>
                                <td>{{ w.order_registraiton_ware.hs_code }}</td>
                                <td>{{ w.order_registraiton_ware.persian_title }}</td>
                                <td>{{ w.order_registraiton_ware.unit_price }}</td>
                                <td>
                                    <input type="text"
                                           class="form-control d-inline w-50"
                                           value="{{ w.gross_weight }}"
                                           readonly>
                                    <small>کیلوگرم</small>
                                </td>
                                <td>
                                    <input type="text"
                                           class="form-control d-inline w-50"
                                           value="{{ w.net_weight }}"
                                           readonly>
                                    <small>کیلوگرم</small>
                                </td>
                                <td>
                                    <input type="text"
                                           class="form-control d-inline w-50"
                                           value="{{ w.amount }}"
                                           readonly>
                                    <span>عدد</span>
                                </td>
                                <td>
                                    <input type="text"
                                           class="form-control d-inline w-50"
                                           value="{{ w.packing_count }}"
                                           readonly>
                                    <small>{{ w.order_registraiton_ware.packing_type }}</small>
                                </td>
                                <td>
                                    <input type="text"
                                           class="form-control d-inline w-50"
                                           value="{{ w.order_registraiton_ware.fob_price }}"
                                           readonly>
                                </td>
                                <td></td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="col-12">
                <div class="d-flex justify-content-end">
                    <div class="mt-3 me-2">
                        <button type="button"
                                class="btn btn-danger btn-cinnabar"
                                data-bs-toggle="modal"
                                data-bs-target="#originCanceleation">
                            <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                            <span class="ps-1">ابطال منشا ارز</span>
                        </button>
                        <!-- Origin canceleation Modal -->
                        <div class="modal fade"
                             id="originCanceleation"
                             tabindex="-1"
                             aria-labelledby="originCanceleationLabel"
                             aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h1 class="modal-title fs-5" id="originCanceleationLabel">ابطال منشا ارز</h1>
                                        <button type="button"
                                                class="btn-close"
                                                data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p>آیا از ابطال منشا ارزی با شماره پرونده {{ object.file_number }} مطمئن هستید؟</p>
                                    </div>
                                    <div class="modal-footer">
                                        <form method="post"
                                              action="{% url 'currency_origin_determining:update_without_currency_status' object.pk %}">
                                            {% csrf_token %}
                                            <input type="hidden" name="status" value="c">
                                            <button type="submit" class="btn btn-secondary rounded-2px">بله</button>
                                            <button type="button"
                                                    class="btn btn-primary btn-maya"
                                                    data-bs-dismiss="modal">خیر</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% if  object.status == 'r' %}
                        <div class="mt-3 me-2">
                            <button type="button"
                                    class="btn btn-danger btn-mango"
                                    data-bs-toggle="modal"
                                    data-bs-target="#originPermitted">
                                <i class="fa fa-upload" aria-hidden="true"></i>
                                <span class="ps-1">اعلام ترخیص کالا</span>
                            </button>
                            <div class="modal fade"
                                 id="originPermitted"
                                 tabindex="-1"
                                 aria-labelledby="originPermittedLabel"
                                 aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5" id="originPermittedLabel">ابطال منشا ارز</h1>
                                            <button type="button"
                                                    class="btn-close"
                                                    data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <p>آیا از ترخیص کالای منشا ارزی با شماره پرونده {{ object.file_number }} مطمئن هستید؟</p>
                                        </div>
                                        <div class="modal-footer">
                                            <form method="post"
                                                  action="{% url 'currency_origin_determining:update_without_currency_status' object.pk %}">
                                                {% csrf_token %}
                                                <input type="hidden" name="status" value="p">
                                                <button type="submit" class="btn btn-secondary rounded-2px">بله</button>
                                                <button type="button"
                                                        class="btn btn-primary btn-maya"
                                                        data-bs-dismiss="modal">خیر</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    <div class="mt-3">
                        <a href="{% url 'currency_origin_determining:without_currency_transfer_list' %}"
                           class="btn btn-primary btn-maya">
                            <i class="fa fa-share" aria-hidden="true"></i>
                            <span class="ps-1">بازگشت</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock main %}
